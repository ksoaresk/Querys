CREATE TRIGGER dbo.validar_ins_anexo_convite ON anexos_conviteAFTER INSERTAS BEGIN	DECLARE @cod_proc_admin 		INT,			  @num_seq_anexo 			INT,			  @num_seq_anexo_hist 	INT,			  @date_cad_old			DATETIME,			  @date_cad_new			DATETIME		SELECT		@num_seq_anexo 	= del.num_seq_anexo	,		@cod_proc_admin 	= del.cod_proc_admin	,		@date_cad_old	  	= del.dat_cad			,		@date_cad_new 	  	= ins.dat_cad	FROM DELETED del		INNER JOIN INSERTED ins ON			del.num_seq_anexo = ins.num_seq_anexo			AND del.cod_proc_admin = ins.cod_proc_admin				IF(@date_cad_old <> @date_cad_new)	BEGIN		SELECT 			@num_seq_anexo_hist = ISNULL(MAX(num_seq_anexo_hist),0) + 1		FROM anexos_convite_historico		WHERE cod_proc_admin = @cod_proc_admin				AND num_seq_anexo = @num_seq_anexo								INSERT INTO historico_anexos_convite(num_seq_anexo,														 cod_proc_admin,														 num_seq_anexo_hist,														 cod_user,														 descricao,														 anexo,														 extensao,														 dat_cad_hist)		SELECT			num_seq_anexo,			cod_proc_admin,			@num_seq_anexo_hist,			cod_user,			descricao,			anexo,			extensao,			dat_cad_hist		FROM DELETED				IF(@@ERROR <> 0)		BEGIN			ROLLBACK			RAISERROR('TG: Não foi possível gerar o histórico na atualização.',16,1)			RETURN		END	ENDEND