ALTER TRIGGER dbo.validar_upd_convite_licitacaoON convite_licitacaoWITH ENCRYPTION FOR UPDATEASBEGIN	DECLARE @cod_proc_adm   INT,			  @ocod_sit_conv  INT,			  @ncod_sit_conv  INT,			  @odat_inic_conv DATETIME,			  @ndat_inic_conv DATETIME,			  @ndata_fechamento DATETIME	SELECT		@cod_proc_adm 		= DEL.cod_proc_adm	,		@ocod_sit_conv 	= DEL.cod_sit_conv	,		@ncod_sit_conv 	= INS.cod_sit_conv	,		@odat_inic_conv	= DEL.data_abertura	,		@ndat_inic_conv	= INS.data_abertura	,		@ndata_fechamento = INS.data_fechamento	FROM INSERTED INS		INNER JOIN DELETED DEL ON			DEL.cod_proc_adm = INS.cod_proc_adm			IF(@ocod_sit_conv <> @ncod_sit_conv AND @ncod_sit_conv NOT IN(1, 6) AND @ocod_sit_conv <> 7)	BEGIN		IF(EXISTS(SELECT 						TOP 1 1					 FROM convite_estrutura_dfp					 WHERE cod_proc_adm = @cod_proc_adm 							 AND (cod_sit_conv_estru <> 4									OR cod_equipe IS NULL)))		BEGIN			ROLLBACK			RAISERROR('TG: Não é possível ENCAMINHAR / NEGOCIAR / FINALIZAR propostas que não tenha sido concluída. Finalize a estrutura da D.F.P para dar prosseguimento ao convite.', 16, 1);			RETURN		END	END			IF(EXISTS(SELECT					TOP 1 1 				FROM convite_estrutura_dfp 				WHERE cod_proc_adm = @cod_proc_adm						AND ISNULL(data_entrega, @ndata_fechamento) > @ndata_fechamento))	BEGIN		ROLLBACK		RAISERROR('TG2:A data de fechamento da proposta não pode ser menor que as datas para entrega da estrutura. Verifique os dados informados e tente novamente.', 16, 1);		RETURN	END		IF(@ndat_inic_conv <> @odat_inic_conv)	BEGIN		UPDATE convite_estrutura_dfp			SET data_inicio = @ndat_inic_conv		WHERE cod_proc_adm = @cod_proc_adm	ENDEND